<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ chunk.title }} - Knowledge Base</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: #333; margin-bottom: 20px; }
        .back-link { color: #667eea; text-decoration: none; margin-bottom: 20px; display: inline-block; }
        .back-link:hover { text-decoration: underline; }
        .info-grid { display: grid; grid-template-columns: 150px 1fr; gap: 15px; margin-bottom: 30px; }
        .info-label { font-weight: 600; color: #666; }
        .info-value { color: #333; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.85em; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-category { background: #e3f2fd; color: #1565c0; }
        .content-box { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .content-text { white-space: pre-wrap; word-wrap: break-word; line-height: 1.6; }
        .metadata-box { background: #263238; color: #aed581; padding: 15px; border-radius: 8px; margin: 20px 0; font-family: 'Courier New', monospace; }
        .edit-form { display: none; }
        .edit-form.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;
        }
        .form-group textarea { resize: vertical; min-height: 200px; font-family: 'Courier New', monospace; }
        .btn { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px; }
        .btn:hover { background: #5a67d8; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .related-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .related-item { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 3px solid #667eea; }
        .related-item a { color: #667eea; text-decoration: none; font-weight: 600; }
        .related-item a:hover { text-decoration: underline; }
        .stats-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-card { flex: 1; background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 1.5em; font-weight: bold; color: #333; }
        .stat-label { color: #666; margin-top: 5px; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üìÑ Detalhes do Documento</h1>
        </div>
    </div>

    <div class="container">
        <a href="/admin/knowledge-base" class="back-link">‚Üê Voltar √† Base de Conhecimento</a>

        <!-- Document Stats -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value">{{ chunk.content_length }}</div>
                <div class="stat-label">Caracteres</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ chunk.content.split()|length }}</div>
                <div class="stat-label">Palavras</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">
                    {% if chunk.has_embedding %}
                    <span style="color: #4caf50;">‚úì</span>
                    {% else %}
                    <span style="color: #f44336;">‚úó</span>
                    {% endif %}
                </div>
                <div class="stat-label">Embedding</div>
            </div>
        </div>

        <!-- View Mode -->
        <div id="view-mode" class="section">
            <h2>{{ chunk.title }}</h2>
            
            <div class="info-grid">
                <div class="info-label">ID:</div>
                <div class="info-value" style="font-family: monospace;">{{ chunk.id }}</div>
                
                <div class="info-label">Parent ID:</div>
                <div class="info-value" style="font-family: monospace;">{{ chunk.parent_id|default('N/A') }}</div>
                
                <div class="info-label">Categoria:</div>
                <div class="info-value">
                    {% if chunk.category %}
                    <span class="badge badge-category">{{ chunk.category }}</span>
                    {% else %}
                    <span style="color: #999;">N√£o categorizado</span>
                    {% endif %}
                </div>
                
                <div class="info-label">Criado em:</div>
                <div class="info-value">{{ chunk.created_at|default('N/A') }}</div>
                
                <div class="info-label">Atualizado em:</div>
                <div class="info-value">{{ chunk.updated_at|default('N/A') }}</div>
                
                <div class="info-label">Embedding:</div>
                <div class="info-value">
                    {% if chunk.has_embedding %}
                    <span class="badge badge-success">‚úì Configurado</span>
                    {% else %}
                    <span style="color: #f44336;">‚úó N√£o configurado</span>
                    {% endif %}
                </div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 10px;">Conte√∫do</h3>
            <div class="content-box">
                <div class="content-text">{{ chunk.content }}</div>
            </div>

            {% if chunk.metadata %}
            <h3 style="margin-top: 30px; margin-bottom: 10px;">Metadata</h3>
            <div class="metadata-box">
                <pre>{{ chunk.metadata|tojson(indent=2) }}</pre>
            </div>
            {% endif %}

            <div style="margin-top: 30px;">
                <button class="btn" onclick="toggleEditMode()">‚úèÔ∏è Editar</button>
                <button class="btn btn-secondary" onclick="generateEmbedding()">üîÑ Gerar Embedding</button>
            </div>
        </div>

        <!-- Edit Mode -->
        <div id="edit-mode" class="section edit-form">
            <h2>Editar Documento</h2>
            
            <form action="/admin/knowledge-base/{{ chunk.id }}/edit" method="POST">
                <div class="form-group">
                    <label for="title">T√≠tulo</label>
                    <input type="text" id="title" name="title" value="{{ chunk.title }}" required>
                </div>

                <div class="form-group">
                    <label for="category">Categoria</label>
                    <select id="category" name="category">
                        <option value="">Sem categoria</option>
                        <option value="constituicao" {% if chunk.category == 'constituicao' %}selected{% endif %}>Constitui√ß√£o</option>
                        <option value="lei_federal" {% if chunk.category == 'lei_federal' %}selected{% endif %}>Lei Federal</option>
                        <option value="codigo" {% if chunk.category == 'codigo' %}selected{% endif %}>C√≥digo</option>
                        <option value="decreto" {% if chunk.category == 'decreto' %}selected{% endif %}>Decreto</option>
                        <option value="sumula" {% if chunk.category == 'sumula' %}selected{% endif %}>S√∫mula</option>
                        <option value="jurisprudencia" {% if chunk.category == 'jurisprudencia' %}selected{% endif %}>Jurisprud√™ncia</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="content">Conte√∫do</label>
                    <textarea id="content" name="content" required>{{ chunk.content }}</textarea>
                </div>

                <div class="form-group">
                    <label for="metadata">Metadata (JSON)</label>
                    <textarea id="metadata" name="metadata" style="min-height: 100px;">{{ chunk.metadata|tojson(indent=2) }}</textarea>
                </div>

                <div style="margin-top: 30px;">
                    <button type="submit" class="btn">üíæ Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-secondary" onclick="toggleEditMode()">Cancelar</button>
                </div>
            </form>
        </div>

        <!-- Related Items -->
        {% if chunk.related %}
        <div class="section">
            <h2>Documentos Relacionados</h2>
            <div class="related-items">
                {% for item in chunk.related %}
                <div class="related-item">
                    <a href="/admin/knowledge-base/{{ item.id }}">{{ item.title|truncate(50) }}</a>
                    {% if item.category %}
                    <div style="margin-top: 5px;">
                        <span class="badge badge-category">{{ item.category }}</span>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        function toggleEditMode() {
            const viewMode = document.getElementById('view-mode');
            const editMode = document.getElementById('edit-mode');
            
            if (editMode.classList.contains('active')) {
                editMode.classList.remove('active');
                viewMode.style.display = 'block';
            } else {
                editMode.classList.add('active');
                viewMode.style.display = 'none';
            }
        }

        function generateEmbedding() {
            if (confirm('Gerar novo embedding para este documento?')) {
                fetch('/admin/knowledge-base/{{ chunk.id }}/embedding', {
                    method: 'POST'
                }).then(response => {
                    if (response.ok) {
                        alert('Embedding gerado com sucesso!');
                        location.reload();
                    } else {
                        alert('Erro ao gerar embedding');
                    }
                });
            }
        }

        // Check for edit hash in URL
        if (window.location.hash === '#edit') {
            toggleEditMode();
        }
    </script>
</body>
</html>
